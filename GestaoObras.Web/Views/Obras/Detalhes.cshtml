@model GestaoObras.Web.ViewModels.ObraDetalhesViewModel
@using Microsoft.AspNetCore.Mvc.Rendering

@{
    ViewData["Title"] = "Detalhes da Obra";
    var materiais = ViewBag.Materiais as List<GestaoObras.Web.Models.Material>;
}

<h2>@Model.Obra.Nome</h2>

<p><strong>Cliente:</strong> @Model.Obra.Cliente?.Nome</p>
<p><strong>Morada:</strong> @Model.Obra.Morada</p>
<p><strong>Ativa:</strong> @(Model.Obra.Ativa ? "Sim" : "Não")</p>

<ul class="nav nav-tabs">
    <li class="nav-item">
        <a class="nav-link active" data-bs-toggle="tab" href="#dados">Dados gerais</a>
    </li>
    <li class="nav-item">
        <a class="nav-link" data-bs-toggle="tab" href="#materiais">Material</a>
    </li>
    <li class="nav-item">
        <a class="nav-link" data-bs-toggle="tab" href="#maoobra">Mão de Obra</a>
    </li>
    <li class="nav-item">
        <a class="nav-link" data-bs-toggle="tab" href="#pagamentos">Pagamentos</a>
    </li>
</ul>

<div class="tab-content mt-3">
    <!-- Dados gerais -->
    <div class="tab-pane fade show active" id="dados">
        <p>@Model.Obra.Descricao</p>
        <p><strong>Latitude:</strong> @Model.Obra.Latitude</p>
        <p><strong>Longitude:</strong> @Model.Obra.Longitude</p>
    </div>

    <!-- Material -->
    <div class="tab-pane fade" id="materiais">
        <h4>Movimentos de Material</h4>
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>Material</th>
                    <th>Operação</th>
                    <th>Quantidade</th>
                    <th>Data</th>
                </tr>
            </thead>
            <tbody>
            @foreach (var m in Model.MovimentosStock)
            {
                <tr>
                    <td>@m.Material?.Nome</td>
                    <td>@m.Operacao</td>
                    <td>@m.Quantidade</td>
                    <td>@m.DataHora</td>
                </tr>
            }
            </tbody>
        </table>

        <h5>Adicionar movimento</h5>
        <form asp-action="AdicionarMovimento" method="post">
            <input type="hidden" name="obraId" value="@Model.Obra.Id" />
            <div class="mb-2">
                <label class="form-label">Material</label>
                <select asp-for="NovoMovimento.MaterialId" class="form-select"
                        asp-items="@(new SelectList(materiais, "Id", "Nome"))"></select>
            </div>
            <div class="mb-2">
                <label class="form-label">Quantidade</label>
                <input asp-for="NovoMovimento.Quantidade" class="form-control" />
            </div>
            <button type="submit" class="btn btn-primary">Guardar</button>
        </form>
    </div>

    <!-- Mão de Obra -->
    <div class="tab-pane fade" id="maoobra">
        <h4>Registos de Mão de Obra</h4>
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>Nome</th>
                    <th>Horas</th>
                    <th>Data</th>
                </tr>
            </thead>
            <tbody>
            @foreach (var r in Model.RegistosMaoObra)
            {
                <tr>
                    <td>@r.NomePessoa</td>
                    <td>@r.HorasTrabalhadas</td>
                    <td>@r.DataHora</td>
                </tr>
            }
            </tbody>
        </table>

        <h5>Adicionar registo</h5>
        <form asp-action="AdicionarMaoObra" method="post">
            <input type="hidden" name="obraId" value="@Model.Obra.Id" />
            <div class="mb-2">
                <label class="form-label">Nome</label>
                <input asp-for="NovoRegistoMaoObra.NomePessoa" class="form-control" />
            </div>
            <div class="mb-2">
                <label class="form-label">Horas trabalhadas</label>
                <input asp-for="NovoRegistoMaoObra.HorasTrabalhadas" class="form-control" />
            </div>
            <button type="submit" class="btn btn-primary">Guardar</button>
        </form>
    </div>

    <!-- Pagamentos -->
    <div class="tab-pane fade" id="pagamentos">
        <h4>Pagamentos</h4>
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>Nome</th>
                    <th>Valor</th>
                    <th>Data</th>
                </tr>
            </thead>
            <tbody>
            @foreach (var p in Model.Pagamentos)
            {
                <tr>
                    <td>@p.NomePessoa</td>
                    <td>@p.Valor</td>
                    <td>@p.DataHora</td>
                </tr>
            }
            </tbody>
        </table>

        <h5>Adicionar pagamento</h5>
        <form asp-action="AdicionarPagamento" method="post">
            <input type="hidden" name="obraId" value="@Model.Obra.Id" />
            <div class="mb-2">
                <label class="form-label">Nome</label>
                <input asp-for="NovoPagamento.NomePessoa" class="form-control" />
            </div>
            <div class="mb-2">
                <label class="form-label">Valor</label>
                <input asp-for="NovoPagamento.Valor" class="form-control" />
            </div>
            <button type="submit" class="btn btn-primary">Guardar</button>
        </form>
    </div>
</div>
